<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Infinity Portal Login</title>
  <link rel="icon" href="favicon.ico" />
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0; padding: 0; color: #FFF;}
    .login-container { max-width: 340px; margin: 13vh auto 0; background: rgba(24,28,46,0.95); border-radius: 18px; box-shadow: 0 2px 15px #0002; padding: 2.2em 2em 1.5em 2em; text-align: center;}
    h1 { font-size: 2rem; letter-spacing: .07em; margin-bottom: 0.8em; background: linear-gradient(90deg,#44e4be,#a388fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
    .biometric-sim {background: #282b4b; color: #b5daf8; border-radius: 10px; padding: 1.1em 0.55em; margin-bottom: 1.1em;}
    .hide {display: none;}
    label { display: block; margin-top: 1em; font-weight: 600; text-align: left; color: #8beecc;}
    input[type="text"], input[type="password"], input[type="email"] { width: 98%; padding: 0.75em; margin-top: 0.1em; margin-bottom: 0.4em; border-radius: 7px; border: 1px solid #3e4777; background: #161a2c; color: #fff; font-size: 1.03em; box-sizing: border-box;}
    button { margin-top: 1.35em; width: 72%; padding: 0.75em 0; font-size: 1.08em; font-weight: bold; background: linear-gradient(90deg,#44e4be,#a388fc); color: #fff; border: none; border-radius: 8px; box-shadow: 0 1px 7px #44e4be44; cursor: pointer; transition: filter 0.15s;}
    button:active,button:focus {filter: brightness(0.89); outline: none;}
    .error-msg { color: #ff7892; font-size: .95em; margin-bottom: 0.5em;}
    #mainApp { display: none; min-height: 90vh;}
    .footer { margin-top: 46px; font-size: 0.95em; color: #b5daf8; opacity: .93; text-align: center;}
    .verse { font-size: .91em; color: #8beecc;}
    .powered { font-size: .87em; color: #676; opacity: .89; margin-top: 3px;}
  </style>
  <!-- Load main app logic if login succeeds -->
  <script defer src="app.js"></script>
</head>
<body>
  <div class="login-container" id="loginPanel">
    <h1>Infinity Portal</h1>
    <form id="loginForm" autocomplete="off">
      <div class="biometric-sim" id="biometricPrompt">
        <span>Scan your fingerprint or face to continue.<br><button type="button" id="biometricBtn">Simulate Scan</button></span>
      </div>
      <div class="error-msg" id="errorMsg"></div>
      <label for="username">Username:</label>
      <input type="text" id="username" placeholder="Kris" autocomplete="off" />
      <label for="password">Password:</label>
      <input type="password" id="password" placeholder="Biometric/Password" autocomplete="off" />
      <label for="email">Email:</label>
      <input type="email" id="email" placeholder="marvaseater@gmail.com" autocomplete="off" />
      <button type="submit">Sign In</button>
    </form>
  </div>
  <div id="mainApp">
    <!-- This is the real dashboard; app.js injects content here after login -->
    <div id="vectorAppRoot"></div>
  </div>
  <div class="footer">
    <div class="verse">John 4:36 â€“ "Already the one who reaps draws a wage and harvests a crop for eternal life, so that the sower and the reaper may be glad together."</div>
    <div class="powered">Powered by Infinity</div>
  </div>
  <script>
    // Ensure session clears at start
    window.onload = () => {
      sessionStorage.clear();
      localStorage.removeItem("infinityUser");
      document.getElementById("loginForm").classList.add("hide");
    };

    let biometricReady = false;
    document.getElementById("biometricBtn").addEventListener("click", function(){
      biometricReady = true;
      document.getElementById("biometricPrompt").innerHTML = "<b>Biometrics scan complete. Proceed to sign in.</b>";
      setTimeout(function(){
        document.getElementById("biometricPrompt").classList.add("hide");
        document.getElementById("loginForm").classList.remove("hide");
      }, 900);
    });

    // Modified Infinity Login logic
    document.getElementById("loginForm").addEventListener("submit", function(e){
      e.preventDefault();
      if (!biometricReady) {
        document.getElementById("errorMsg").textContent = "Please scan biometrics first.";
        return;
      }
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value;
      const email = document.getElementById("email").value.trim();
      const errorMsg = document.getElementById("errorMsg");
      errorMsg.textContent = "";
      // Only allow admin login for Kris
      if(username.toLowerCase()!=="kris") {
        if(password.length < 6) {
          errorMsg.textContent = "Regular users: password must be at least 6 characters.";
          return;
        }
        // Regular user: email required
        if(!email.match(/\S+@\S+\.\S+/)) {
          errorMsg.textContent = "Valid email required.";
          return;
        }
        // Save user & proceed
        sessionStorage.setItem("infinityUser", JSON.stringify({username,email,admin:false,loginTime:Date.now()}));
        localStorage.setItem("infinityUser", JSON.stringify({username,email,admin:false,loginTime:Date.now()}));
      } else {
        // Allow Kris (admin) to have 4+ chars for password
        if(password.length < 4) {
          errorMsg.textContent = "Kris: password must be at least 4 characters.";
          return;
        }
        if(email.toLowerCase()!=="marvaseater@gmail.com") {
          errorMsg.textContent = "Admin email required.";
          return;
        }
        // "Hide" Kris's admin status with a simple hash (for demonstration)
        // In production, use real hash!
        const krisHash = btoa("Kris:" + password + ":secretadmin!");
        sessionStorage.setItem("krisAdmin", krisHash);
        sessionStorage.setItem("infinityUser", JSON.stringify({username,email,admin:true,loginTime:Date.now()}));
        localStorage.setItem("infinityUser", JSON.stringify({username,email,admin:true,loginTime:Date.now()}));
      }
      // Hide login, show main
      document.getElementById("loginPanel").style.display = "none";
      document.getElementById("mainApp").style.display = "block";
      // Call main dashboard loader if available from app.js
      if(window.InfinityVectorApp) {
        const app = new window.InfinityVectorApp();
        app.init();
        app.loadZone && app.loadZone("home");
      }
    });
  </script>
</body>
</html>